function getRankByType(t,a,e=!1){var n=$(a).find(".existing_rank").val();t&&$.ajax({url:$("#site_url").val()+"/setup_/getRankByType",type:"POST",data:{id:t},success:function(t){e?$(a).find(".rank").html(t):$(a).find(".rank").html(t).change(),n&&$(a).find(".rank").val(n)}})}function saveBESalary(){var t={},a=!1;if($(".data-list").each(function(){if("NOTSAVED"==$(this).attr("status-tag")){a=!0,employeeid=$(this).attr("employeeid"),t[employeeid]={},t[employeeid].eid=employeeid,t[employeeid].isFixed=$(this).find("input[name=isFixed]").is(":checked")?1:0,t[employeeid].monthly=$(this).find("input[name=monthly]").val(),t[employeeid].semimonthly=$(this).find("input[name=semimonthly]").val(),t[employeeid].daily=$(this).find("input[name=daily]").val(),t[employeeid].hourly=$(this).find("input[name=hourly]").val(),t[employeeid].minutely=$(this).find("input[name=minutely]").val(),t[employeeid].sched=$(this).find("select[name=schedule]").val(),t[employeeid].tax_status=$(this).find("select[name=tax_status]").val(),t[employeeid].rank=$(this).find("select[name=rank]").val(),t[employeeid].type=$(this).find("select[name=type]").val();var e=[],n={},i=labhour=aimsdept="";$(this).find(".leclab-pay").each(function(){i=$(this).find(".lechour").val(),labhour=$(this).find(".labhour").val(),aimsdept=$(this).find(".aimsdept").val(),n={lechour:i,labhour:labhour,aimsdept:aimsdept},e.push(n),n={}}),t[employeeid].leclab_arr=JSON.stringify(e)}}),!a)return $("#errorMsg").html("NO CHANGES WERE MADE.").css("color","red"),!1;$.ajax({url:$("#site_url").val()+"/payroll_/saveSalaryBatch",type:"POST",dataType:"json",data:{form_data:t},success:function(t){}})}function getPayrollRank(){$("#be_salary").find("tr").each(function(){var t=$(this).closest("tr");getRankByType($(t).find(".type").val(),t,!0)})}function getMonthlyFromDaily(t,a){return"teaching"==a?262*t/12:314*t/12}function computeSalary(t,a,e="monthly",n="teaching",i){var l=a/2;$("#college").val()&&"teaching"==n?(daily=a/26.17,hourly=a/88.2,minutely=hourly/60):(daily=a/26.17,hourly=a/91,minutely=hourly/60),"monthly"!=e&&$(t).find("input[name=monthly]").val(a.toFixed(2)),"semimonthly"!=e&&$(t).find("input[name=semimonthly]").val(l.toFixed(2)),"daily"!=e&&$(t).find("input[name=daily]").val(daily.toFixed(2)),"hourly"!=e&&$(t).find("input[name=hourly]").val(hourly.toFixed(2)),"semimonthly"!=e&&$(t).find("input[name=minutely]").val(minutely.toFixed(2))}function validateChanges(t,a=!1,e){var n=!1,i=$(t).find("input[name=isFixed]"),l=$(i).is(":checked")?1:0;if(n=$(i).attr("oldvalue")!=l)return n;var o=$(t).find("input[name=monthly]");if(n=$(o).attr("oldvalue")!=$(o).val())return n;var s=$(t).find("select[name=schedule]");if(n=$(s).attr("oldvalue")!=$(s).val())return n;var u=$(t).find("select[name=tax_status]");return(n=$(u).attr("oldvalue")!=$(u).val())?n:n=validateStatusUpdateLecLabRate($(t).find(".wrap_leclabpay"),a,e)}function validateStatusUpdateLecLabRate(t,a,e){var n=!1,l=[],o=[],s="",u="";if($(t).find(".leclab-pay").each(function(){s=$(this).find(".lechour").val()+"~u~"+$(this).find(".labhour").val()+"~u~"+$(this).find(".aimsdept").val(),l.push(s)}),$(t).find(".old-value").each(function(){o.push($(this).val())}),a)o.includes(e)&&(n=!0);else{for(i=0;i<o.length&&(u=o[i],l.includes(u)||(n=!0),1!=n);i++);for(i=0;i<l.length&&(s=l[i],o.includes(s)||(n=!0),1!=n);i++);}return n}function changeStatusTag(t,a){t?updateStatusTag(a):removeStatusTag(a)}function updateStatusTag(t){$(t).find(".dataStatus").hide(),$(t).attr("status-tag","NOTSAVED"),$(t).find(".status-tag").html("NOT SAVED").css("color","red")}function removeStatusTag(t){$(t).attr("status-tag",""),$(t).find(".status-tag").html("")}function addCommas(t){t+="",x=t.split("."),x1=x[0],x2=x.length>1?"."+x[1]:"";for(var a=/(\d+)(\d{3})/;a.test(x1);)x1=x1.replace(a,"$1,$2");return t}function numbersonly(t,a,e,n){var i,l;if(window.event)i=window.event.keyCode;else{if(!a)return!0;i=a.which}return l=String.fromCharCode(i),null==i||0==i||8==i||9==i||13==i||27==i||((n?"0123456789.- ":"0123456789.").indexOf(l)>-1||!(!e||"."!=l)&&(t.form.elements[e].focus(),!1))}getPayrollRank(),$(".add_leclabpay").on("click",function(){var t=$(this).parent().parent().clone(!0);t.find(".lechour").val(0),t.find(".labhour").val(0),t.find(".aimsdept").val(""),$(this).closest("tr").find(".wrap_leclabpay").append(t)}),$(".del_leclabpay").on("click",function(){var t=$(this).parent().parent().parent(),a=$(this).parent().parent(),e=$(a).find(".lechour").val()+"~u~"+$(a).find(".labhour").val()+"~u~"+$(a).find(".aimsdept").val();if($(t).find(".leclab-pay").length>1){if(0==$(a).find(".lechour").val()&&0==$(a).find(".labhour").val()&&""==$(a).find(".aimsdept").val());else changeStatusTag(validateChanges(n=$(this).closest("tr"),!0,e),n);$(a).remove()}else{var n;if(0==$(a).find(".lechour").val()&&0==$(a).find(".labhour").val()&&""==$(a).find(".aimsdept").val());else changeStatusTag(validateChanges(n=$(this).closest("tr"),!0,e),n),$(a).find(".lechour").val(0),$(a).find(".labhour").val(0),$(a).find(".aimsdept").val("")}}),$("input[name=monthly], input[name=semimonthly], input[name=daily], input[name=hourly], input[name=minutely], .schedule, .tax_status, .lechour, .labhour, .aimsdept").on("change",function(){var t,a=validateChanges(t=$(this).closest("tr"),!1,""),e=(a=validateChanges(t=$(this).closest("tr"),!1,""),$(t).find(".monthly").val()),n=$(t).find(".semimonthly").val(),i=$(t).find(".daily").val(),l=$(t).find(".hourly").val(),o=$(t).find(".minutely").val(),s=$(t).find(".schedule").val(),u=$(t).find(".tax_status").val();"0"!=e&&"0.00"!=e&&""!=e&&"0"!=n&&"0.00"!=n&&""!=n&&"0"!=i&&"0.00"!=i&&""!=i&&"0"!=l&&"0.00"!=l&&""!=l&&"0"!=o&&"0.00"!=o&&""!=o&&""!=s&&""!=u||$(t).css({"background-color":"#ff6666"}),"0"!=e&&"0.00"!=e&&""!=e&&"0"!=n&&"0.00"!=n&&""!=n&&"0"!=i&&"0.00"!=i&&""!=i&&"0"!=l&&"0.00"!=l&&""!=l&&"0"!=o&&"0.00"!=o&&""!=o&&""!=s&&""!=u&&($(t).css({"background-color":"#99ff99"}),changeStatusTag(a,t),saveBESalary(),$(t).find(".dataStatus").show()),changeStatusTag(a,t)}),$(".lechour, .labhour, .aimsdept").on("change",function(){var t=$(this).closest("tr");changeStatusTag(validateChanges(t,!1,""),t)}),$("input[name=isFixed]").on("click",function(){var t=$(this).closest("tr");changeStatusTag(validateChanges(t,!1,""),t)}),$(".type").on("change",function(){getRankByType($(this).val(),$(this).closest("tr"))}),$(".rank").on("change",function(){var t=0,a=0,e=0,n=$(this).closest("tr"),i=$(this).val(),l=$(this).attr("teachingtype");$.ajax({url:$("#site_url").val()+"/setup_/getRankBasicRate",type:"POST",data:{id:i},success:function(i){$(n).find('input[name="monthly"]').val(i).change(),$(this).attr("iscollege")&&"teaching"==l?(t=i/26.17,e=(a=i/88.2)/60):(t=i/26.17,e=(a=i/91)/60),t=parseFloat(t).toFixed(2),a=parseFloat(a).toFixed(2),e=parseFloat(e).toFixed(2),$(n).find('input[name="semimonthly"]').val(i/2),$(n).find('input[name="daily"]').val(t),$(n).find('input[name="hourly"]').val(a),$(n).find('input[name="minutely"]').val(e)}})}),$("input[name=monthly], input[name=semimonthly], input[name=daily], input[name=hourly], input[name=minutely]").on("keyup",function(){var t=$(this).closest("tr");$(t).find(".rank").val(""),$(t).find(".type").val("")}),$(".lechour").keyup(function(t){if(9===t.keyCode)return!1;lechour=$(this).val(),labhour=.75*Number(lechour),$(this).parent().find(".labhour").val(addCommas(labhour))}),$(".labhour").keyup(function(t){if(9===t.keyCode)return!1;labhour=$(this).val(),lechour=Number(labhour)/3*4,$(this).parent().find(".lechour").val(addCommas(lechour))}),$("input[name=monthly]").keyup(function(t){if(9===t.keyCode)return!1;var a=$(this).closest("tr"),e=$(a).attr("teachingtype"),n=$(a).attr("iscollege");computeSalary(a,$(this).val(),"monthly",e,n)}),$("input[name=semimonthly]").keyup(function(t){if(9===t.keyCode)return!1;var a=$(this).closest("tr"),e=$(a).attr("teachingtype"),n=$(a).attr("iscollege");computeSalary(a,2*$(this).val(),"semimonthly",e,n)}),$("input[name=daily]").keyup(function(t){if(9===t.keyCode)return!1;var a=$(this).closest("tr"),e=$(a).attr("teachingtype");computeSalary(a,getMonthlyFromDaily($(this).val(),e),"monthly",e,$(a).attr("iscollege"))}),$("input[name=hourly]").keyup(function(t){if(9===t.keyCode)return!1;var a=$(this).closest("tr"),e=$(a).attr("teachingtype"),n=$(a).attr("iscollege");computeSalary(a,getMonthlyFromDaily(8*$(this).val(),e),"monthly",e,n)}),$("input[name=minutely]").keyup(function(t){if(9===t.keyCode)return!1;var a=$(this).closest("tr"),e=$(a).attr("teachingtype"),n=$(a).attr("iscollege");computeSalary(a,getMonthlyFromDaily(8*$(this).val()*60,e),"monthly",e,n)}),$(".chosen").chosen(),$("#be_salary").dataTable({pagination:"number",oLanguage:{sEmptyTable:"No Data Available.."},aLengthMenu:[[5,10,20,-1],[5,10,20,"All"]],scrollX:!0});